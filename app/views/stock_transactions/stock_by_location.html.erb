<div class="min-h-screen bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-2xl font-bold text-gray-900"><%= t('stock_transactions.stock_by_location.title') %></h1>
        <p class="mt-1 text-sm text-gray-500"><%= t('stock_transactions.stock_by_location.subtitle') %></p>
      </div>
      
      <div class="flex space-x-4">
        <button onclick="window.print()" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
          </svg>
          <%= t('stock_transactions.stock_by_location.print') %>
        </button>
      </div>
    </div>

    <%= responsive_table(preserve_table: true, class: "bg-white shadow rounded-lg") do %>
      <%= responsive_table_wrapper(
        content_tag(:table, class: "min-w-full divide-y divide-gray-200") do
          content_tag(:thead) do
            content_tag(:tr) do
              item_header = content_tag(:th, t('stock_transactions.stock_by_location.table.item'), 
                scope: "col", 
                class: "px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky-column")
              
              location_headers = @locations.map do |location|
                content_tag(:th, location.name, 
                  scope: "col", 
                  class: "px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider")
              end.join.html_safe
              
              total_header = content_tag(:th, t('stock_transactions.stock_by_location.table.total'), 
                scope: "col", 
                class: "px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider")
              
              item_header + location_headers + total_header
            end
          end +
          content_tag(:tbody, class: "bg-white divide-y divide-gray-200") do
            @items.map do |item|
              content_tag(:tr) do
                item_cell = content_tag(:td, class: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 sticky-column") do
                  content_tag(:div) do
                    item.name + content_tag(:div, item.sku, class: "text-xs text-gray-500")
                  end
                end
                
                location_cells = @locations.map do |location|
                  stock = @stock_levels[item.id][location.id]
                  stock_class = stock.to_f == 0 ? 'text-red-500' : ''
                  content_tag(:td, class: "px-6 py-4 whitespace-nowrap text-sm text-gray-500") do
                    content_tag(:span, number_with_precision(stock, precision: 2, strip_insignificant_zeros: true), class: stock_class)
                  end
                end.join.html_safe
                
                total = @stock_levels[item.id].values.sum { |v| v.to_f }
                total_cell = content_tag(:td, number_with_precision(total, precision: 2, strip_insignificant_zeros: true), 
                  class: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900")
                
                item_cell + location_cells + total_cell
              end
            end.join.html_safe
          end
        end
      ) %>
    <% end %>
  </div>
</div> 